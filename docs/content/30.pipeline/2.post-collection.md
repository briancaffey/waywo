---
title: Post Collection
description: How waywo.yml defines target HN posts and how the pipeline fetches and stores them via the Hacker News Firebase API.
navigation.icon: i-lucide-download
---

# Post Collection

The first pipeline stage identifies which Hacker News "What are you working on?" threads to index and fetches their data.

## waywo.yml

All target posts are defined in `waywo.yml` at the project root. Each entry contains three fields:

| Field   | Type | Description                          |
|---------|------|--------------------------------------|
| `id`    | int  | The Hacker News item ID for the post |
| `year`  | int  | Year the thread was published        |
| `month` | int  | Month (1--12) the thread was published |

### Example entries

```yaml
# waywo.yml
- id: 46264491
  year: 2025
  month: 12

- id: 45869146
  year: 2025
  month: 11

- id: 45561428
  year: 2025
  month: 10
```

The file currently covers threads from March 2022 through December 2025. Some months are commented out where no thread was found.

### Pydantic model

Each entry is parsed into a `WaywoYamlEntry` model:

```python
class WaywoYamlEntry(BaseModel):
    id: int
    year: int
    month: int
```

## Hacker News Firebase API

The `hn_client` module fetches items from the public HN API:

```
https://hacker-news.firebaseio.com/v0/item/{item_id}.json
```

The `fetch_item` function makes a single GET request with a 30-second timeout and returns the JSON payload as a dict, or `None` on failure.

### Returned post fields

A fetched post (story type) includes:

| Field         | Description                        |
|---------------|------------------------------------|
| `id`          | HN item ID                         |
| `type`        | Always `"story"` for posts         |
| `by`          | Author username                    |
| `time`        | Unix timestamp                     |
| `title`       | Post title                         |
| `text`        | Post body text (if any)            |
| `kids`        | Array of top-level comment IDs     |
| `score`       | Upvote count                       |
| `descendants` | Total comment count (all levels)   |

## Storage

Fetched posts are stored via `save_post()` as `WaywoPost` records in SQLite. The model extends a base `HNItem` with post-specific fields and the `year`/`month` metadata from `waywo.yml`:

```python
class WaywoPost(HNItem):
    title: Optional[str] = None
    url: Optional[str] = None
    score: Optional[int] = None
    descendants: Optional[int] = None
    year: Optional[int] = None
    month: Optional[int] = None
```

## How It Runs

The `process_waywo_post` Celery task handles a single post:

1. Calls `fetch_item(post_id)` to get the post data from HN
2. Creates a `WaywoPost` with `year` and `month` from `waywo.yml`
3. Saves the post to SQLite via `save_post()`
4. Iterates through the `kids` array to extract comments (covered in the next section)

The `process_waywo_posts` task loads all entries from `waywo.yml` and dispatches a `process_waywo_post` task for each one:

```python
entries = load_waywo_yaml()
for entry in entries:
    process_waywo_post.delay(
        post_id=entry.id,
        year=entry.year,
        month=entry.month,
    )
```

Both tasks accept optional `limit_posts` and `limit_comments` parameters for testing with smaller batches.

---
title: Frontend
description: Vue composables, components, and page structure for Voice Mode.
navigation.icon: i-lucide-layout-dashboard
---

# Voice Mode Frontend

The Voice Mode frontend is built with three composables, three components, and a single page — all following the same patterns as the rest of the waywo frontend.

## Page

### Voice (`/voice`)

The main voice chat page at `frontend/app/pages/voice.vue`. Layout matches the other pages with a centered hero header.

**Sections:**
- **Header** — Centered icon, title "Voice Mode", subtitle
- **Controls bar** — Thread sidebar toggle, connection status dot, text visibility toggle, voice selector dropdown, debug panel toggle
- **Conversation card** — Scrollable `ScrollArea` (400px) showing message bubbles (user right-aligned, assistant left-aligned) with live partial transcription
- **Voice button** — Large circular hold-to-talk button with state-dependent animations
- **Thread sidebar** — Left-side slide-out panel for conversation management
- **Debug panel** — Right-side slide-out panel for event telemetry

## Composables

### `useVoiceChat`

**File:** `frontend/app/composables/useVoiceChat.ts`

Core composable handling the WebSocket connection, mic capture, audio playback, and conversation state.

**Key features:**
- Inline `AudioWorkletProcessor` for PCM capture at 16kHz mono (downsamples from 48kHz)
- Binary WebSocket frames for audio, JSON text frames for control
- WAV playback via `AudioContext.decodeAudioData()`
- Thread support: `connect(threadId?)` and `loadThreadHistory(id)`
- Accumulates conversation `messages` from WebSocket events

**Reactive state:**

| Property | Type | Description |
|----------|------|-------------|
| `voiceState` | `VoiceState` | `idle`, `listening`, `processing`, `speaking` |
| `connectionState` | `ConnectionState` | `disconnected`, `connecting`, `connected`, `error` |
| `partialTranscription` | `string` | Live STT partial text |
| `finalTranscription` | `string` | Finalized STT text |
| `llmResponse` | `string` | LLM response text |
| `errorMessage` | `string \| null` | Current error message |
| `threadId` | `string \| null` | Active thread ID (from WebSocket) |
| `messages` | `ChatMessage[]` | Accumulated conversation messages |

**Actions:**

| Method | Description |
|--------|-------------|
| `connect(threadId?)` | Open WebSocket (creates or resumes thread) |
| `disconnect()` | Close WebSocket and reset state |
| `startListening()` | Start mic capture and send `start_listening` |
| `stopListening()` | Stop mic and send `stop_listening` |
| `cancel()` | Cancel current turn |
| `setVoice(voice)` | Send `set_voice` message |
| `loadThreadHistory(id)` | Fetch and populate messages from an existing thread |

### `useDebugPanel`

**File:** `frontend/app/composables/useDebugPanel.ts`

Manages debug event collection, filtering, and timing metrics.

**Features:**
- Color-coded categories (stt=blue, llm=purple, tts=green, audio=orange, ws=gray, state=yellow)
- Max 500 event buffer with auto-trim
- Category toggle filters
- Turn timing extraction from state transition events

### `useVoiceThreads`

**File:** `frontend/app/composables/useVoiceThreads.ts`

Thread CRUD operations via the REST API.

**Actions:**

| Method | Description |
|--------|-------------|
| `fetchThreads()` | Load thread list from API |
| `createThread(title?)` | Create a new thread |
| `renameThread(id, title)` | Update thread title |
| `deleteThread(id)` | Delete thread and its turns |
| `setActive(id)` | Set the active thread ID |
| `refreshThread(id)` | Refresh a single thread's title (for auto-title) |

## Components

All voice components are in `frontend/app/components/voice/` and registered with the `Voice` prefix.

### `VoiceButton` (`Button.vue`)

Large circular hold-to-talk button with state-dependent animations:
- **Idle** — Static circle, ready to record
- **Listening** — Pulsing ping animation
- **Processing** — Spinning animation
- **Speaking** — Pulse animation

Emits `press` and `release` events for hold-to-talk interaction.

### `VoiceDebugPanel` (`DebugPanel.vue`)

Right-side collapsible panel (400px wide, slide transition) showing:
- **Metrics bar** — STT, LLM, TTS, and total milliseconds for the current turn
- **Category filters** — Colored pills to toggle event visibility by category
- **Event timeline** — Scrollable log with auto-scroll, showing timestamp, category badge, event name, and data

### `VoiceThreadSidebar` (`ThreadSidebar.vue`)

Left-side collapsible panel (288px wide, slide transition) showing:
- **Header** — "Conversations" title with new thread and close buttons
- **Thread list** — Threads sorted by most recent, each showing title and relative timestamp
- **Delete button** — Visible on hover per thread
- **Backdrop** — Semi-transparent overlay on mobile (dismisses on click)

## TypeScript Types

**File:** `frontend/app/types/voice.ts`

Key types:
- `VoiceState` — `'idle' | 'listening' | 'processing' | 'speaking'`
- `ConnectionState` — `'disconnected' | 'connecting' | 'connected' | 'error'`
- `ClientMessage` — Union of client-to-server message types
- `ServerMessage` — Union of all server-to-client message types
- `VoiceThread` — Thread record with turns
- `VoiceTurnRecord` — Individual turn with timing metadata
- `DebugEvent` — Stored debug event with local timestamp
- `TurnMetrics` — STT/LLM/TTS/total timing for a turn

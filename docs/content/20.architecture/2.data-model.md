---
title: Data Model
description: The three core SQLAlchemy entities — WaywoPost, WaywoComment, and WaywoProject — and how they relate.
navigation.icon: i-lucide-database
---

# Data Model

Waywo uses three SQLAlchemy ORM models mapped to a single SQLite database file (`waywo.db`). The models form a simple hierarchy: a **Post** has many **Comments**, and each Comment can produce one or more **Projects**.

```
WaywoPost (1) ──< WaywoComment (1) ──< WaywoProject
```

## Entity Relationship

```
┌──────────────┐       ┌──────────────────┐       ┌──────────────────────┐
│  WaywoPost   │       │  WaywoComment    │       │  WaywoProject        │
│──────────────│       │──────────────────│       │──────────────────────│
│ id (PK)      │──1:N──│ id (PK)          │──1:N──│ id (PK, auto)        │
│ title        │       │ text             │       │ source_comment_id(FK)│
│ score        │       │ by               │       │ is_valid_project     │
│ by           │       │ time             │       │ title                │
│ time         │       │ parent (FK)      │       │ short_description    │
│ descendants  │       │ processed        │       │ description          │
│ year         │       │ processed_at     │       │ hashtags (JSON)      │
│ month        │       │ ...              │       │ project_urls (JSON)  │
│ kids (JSON)  │       │                  │       │ url_summaries (JSON) │
│ ...          │       │                  │       │ idea_score           │
└──────────────┘       └──────────────────┘       │ complexity_score     │
                                                   │ description_embedding│
                                                   │ workflow_logs (JSON) │
                                                   │ is_bookmarked       │
                                                   │ ...                 │
                                                   └──────────────────────┘
```

## WaywoPost

Represents a monthly "What are you working on?" thread on Hacker News.

| Column | Type | Description |
|---|---|---|
| `id` | `Integer` (PK) | HN item ID |
| `type` | `String(50)` | Always `"story"` |
| `title` | `String(500)` | Post title |
| `by` | `String(255)` | HN username of the poster |
| `time` | `Integer` | Unix timestamp |
| `score` | `Integer` | HN upvote score |
| `descendants` | `Integer` | Total comment count (all levels) |
| `year` | `Integer` | Year from `waywo.yml` metadata |
| `month` | `Integer` | Month from `waywo.yml` metadata |
| `kids` | `Text` | JSON array of top-level comment IDs |
| `text` | `Text` | Post body (usually empty for these threads) |
| `url` | `String(2000)` | Post URL (usually empty) |
| `dead` | `Boolean` | Whether the post is marked dead |
| `deleted` | `Boolean` | Whether the post is deleted |
| `created_at` | `DateTime` | Record creation time |
| `updated_at` | `DateTime` | Last update time |

::note
The `kids` column stores a JSON-serialized array of comment IDs. Helper methods `get_kids_list()` and `set_kids_list()` handle serialization.
::

**Indexes:** Composite index on `(year, month)` for chronological queries.

## WaywoComment

Represents a top-level comment on a WaywoPost -- typically one person describing what they are working on.

| Column | Type | Description |
|---|---|---|
| `id` | `Integer` (PK) | HN item ID |
| `type` | `String(50)` | Always `"comment"` |
| `text` | `Text` | Raw HTML comment body |
| `by` | `String(255)` | HN username |
| `time` | `Integer` | Unix timestamp |
| `parent` | `Integer` (FK) | References `waywo_posts.id` |
| `kids` | `Text` | JSON array of child comment IDs |
| `dead` | `Boolean` | Whether the comment is dead |
| `deleted` | `Boolean` | Whether the comment is deleted |
| `processed` | `Boolean` | Whether the workflow has processed this comment |
| `processed_at` | `DateTime` | When processing completed |
| `created_at` | `DateTime` | Record creation time |
| `updated_at` | `DateTime` | Last update time |

**Indexes:** `parent`, `processed`, `by`.

The `processed` flag is the key workflow control field. Celery tasks query for comments where `processed = False` and feed them into the `WaywoProjectWorkflow`.

## WaywoProject

The core entity -- a structured representation of a project extracted from a comment by the AI pipeline.

| Column | Type | Description |
|---|---|---|
| `id` | `Integer` (PK) | Auto-incrementing ID |
| `source_comment_id` | `Integer` (FK) | References `waywo_comments.id` |
| `is_valid_project` | `Boolean` | Whether the LLM classified this as a real project |
| `invalid_reason` | `String(500)` | Why it was marked invalid (e.g. `"deleted_or_removed"`, `"personal task"`) |
| `title` | `String(500)` | LLM-generated project title |
| `short_description` | `String(200)` | 5-10 word summary |
| `description` | `Text` | 1-2 sentence description |
| `hashtags` | `Text` | JSON array of 3-5 lowercase tags |
| `project_urls` | `Text` | JSON array of URLs found in the comment |
| `url_summaries` | `Text` | JSON dict mapping URL to a content summary |
| `idea_score` | `Integer` | 1-10 rating of idea quality |
| `complexity_score` | `Integer` | 1-10 rating of technical complexity |
| `description_embedding` | `LargeBinary` | 4096-dim FLOAT32 vector blob for semantic search |
| `workflow_logs` | `Text` | JSON array of timestamped processing log entries |
| `is_bookmarked` | `Boolean` | User bookmark flag |
| `created_at` | `DateTime` | Record creation time |
| `processed_at` | `DateTime` | When the workflow finished |

::note
Several columns store JSON as `Text`. Each has corresponding helper methods (e.g. `get_hashtags_list()` / `set_hashtags_list()`) for serialization. This avoids the need for a JSON column type while keeping SQLite compatibility.
::

**Indexes:** `source_comment_id`, `idea_score`, `complexity_score`, `is_valid_project`, `created_at`.

## Vector Search

The `description_embedding` column holds a raw `FLOAT32` byte blob produced by `llama-embed-nemotron-8b` (4096 dimensions). On each database connection, the `sqlite-vector` extension is loaded and initialized:

```python
vector_init('waywo_projects', 'description_embedding',
            'type=FLOAT32,dimension=4096,distance=COSINE')
```

After embeddings are inserted, `vector_quantize()` builds an approximate nearest-neighbor index for fast similarity queries. The `semantic_search()` function in `db_client.py` wraps the low-level vector SQL.

## Database Configuration

The database lives at the path set by the `DATA_DIR` environment variable (defaults to `/app/data` in Docker). Key SQLite pragmas:

- `PRAGMA foreign_keys=ON` -- enforces FK constraints
- sqlite-vector extension loaded on every connection
- `check_same_thread=False` -- required for multi-threaded FastAPI/Celery access

The `SessionLocal` factory provides scoped sessions, and `get_db()` is the FastAPI dependency for request-scoped sessions.

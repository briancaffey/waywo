---
title: Architecture Overview
description: High-level architecture of Waywo â€” from Hacker News data collection through AI processing to semantic search and RAG retrieval.
navigation.icon: i-lucide-map
---

# Architecture Overview

Waywo is built around a three-phase data pipeline: **Collection**, **Processing**, and **Retrieval**. Raw data flows in from Hacker News, gets transformed by AI into structured project records with vector embeddings, and is then queryable via semantic search or a RAG chatbot.

## Three Phases

### 1. Collection

The collection phase pulls data from the Hacker News Firebase API and stores it in SQLite.

- A curated list of monthly "What are you working on?" post IDs is maintained in `waywo.yml`
- Celery tasks fetch each post and its top-level comments via the HN API
- Posts and comments are persisted as `WaywoPost` and `WaywoComment` records
- Celery Beat schedules periodic re-collection to pick up new threads

### 2. Processing

The processing phase runs each unprocessed comment through a LlamaIndex workflow (`WaywoProjectWorkflow`) that extracts structured project data.

| Step | What happens | Output |
|---|---|---|
| **Extract** | LLM identifies individual projects within a comment (handles multi-project comments) | One or more raw project texts |
| **Validate** | LLM determines if the text describes a real project vs. a personal task or deleted comment | `is_valid` flag + reason |
| **Fetch URLs** | Extracts URLs from the text and scrapes their content via Firecrawl | URL markdown content |
| **Metadata** | LLM generates title, short description, description, hashtags, and URL summaries | Structured metadata |
| **Score** | LLM rates the project on idea quality (1-10) and complexity (1-10) | Two integer scores |
| **Embed** | Embedding service (`llama-embed-nemotron-8b`) generates a 4096-dim vector from title + description + hashtags | `FLOAT32` vector blob |

Each step is a `@step`-decorated method on the workflow class, with typed Pydantic events carrying data between steps.

### 3. Retrieval

Retrieval supports two modes, both powered by the same vector index.

**Semantic Search** -- The user's query is embedded, then matched against project embeddings using `sqlite-vector` cosine similarity. An optional reranking pass (`llama-nemotron-rerank-1b-v2`) re-scores the top candidates for improved relevance.

**RAG Chatbot** -- A second LlamaIndex workflow (`WaywoChatbotWorkflow`) chains together: embed query, retrieve candidates (top_k x 3), rerank to top_k, then prompt the LLM (`Nemotron-3-Nano-30B`) with the project context to generate a conversational answer.

## Data Flow Diagram

```
waywo.yml (post IDs)
       |
       v
+----------------+       +--------------------+
| HN Firebase    | ----> | Celery Task        |
| API            |       | (process_waywo_    |
+----------------+       |  posts)            |
                          +--------+-----------+
                                   |
                                   v
                          +--------+-----------+
                          | SQLite             |
                          | waywo_posts        |
                          | waywo_comments     |
                          +--------+-----------+
                                   |
                     Celery task:  |  process_waywo_comments
                                   v
                          +--------+-----------+
                          | WaywoProject       |
                          | Workflow           |
                          | (LlamaIndex)       |
                          +--------+-----------+
                                   |
          +----------+----------+--+--+----------+---------+
          |          |          |     |          |         |
       Extract   Validate   Fetch  Meta-     Score     Embed
       Projects  Project    URLs   data      Project   (4096d)
          |          |          |     |          |         |
          +----------+----------+--+--+----------+---------+
                                   |
                                   v
                          +--------+-----------+
                          | SQLite             |
                          | waywo_projects     |
                          | + vector index     |
                          +--------+-----------+
                                   |
                    +--------------+--------------+
                    |                             |
                    v                             v
          +---------+--------+         +----------+---------+
          | Semantic Search  |         | RAG Chatbot        |
          | embed query -->  |         | embed --> retrieve  |
          | vector search -->|         | --> rerank -->      |
          | rerank (opt)     |         | LLM response       |
          +------------------+         +--------------------+
```

## Key Design Decisions

- **SQLite + sqlite-vector** -- Single-file database keeps deployment simple while still supporting cosine-similarity vector search over 4096-dimensional embeddings.
- **LlamaIndex Workflows** -- The `@step` / Event pattern gives clear, testable processing stages with built-in async support and OpenTelemetry tracing.
- **Three-model AI stack** -- Separating LLM reasoning, embedding, and reranking across specialized NVIDIA Nemotron models lets each model run on its own GPU and be scaled independently.
- **Celery for orchestration** -- Long-running HN scraping and LLM-heavy processing run as background tasks, keeping the FastAPI server responsive.

::tip
See the [Tech Stack](/architecture/tech-stack) page for a full inventory of every dependency, and [Service Map](/architecture/service-map) for the Docker Compose topology.
::

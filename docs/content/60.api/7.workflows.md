---
title: Workflows
description: Endpoints for inspecting workflow prompts, visualizing workflow structure, and running workflows with execution traces.
navigation.icon: i-lucide-git-branch
---

# Workflows

Waywo uses LlamaIndex workflows for its AI processing pipelines. These endpoints let you inspect the prompts used by each workflow step, list available workflows, generate structure visualizations, and run workflows with full execution tracing.

## List Workflow Prompts

Return every workflow step and its associated prompt template. Useful for inspecting and iterating on the prompts used during comment processing and chatbot pipelines.

```
GET /api/workflow-prompts
```

**Parameters:** None

**Response:** `200 OK`

```json
{
  "steps": [
    {
      "step": "extract_projects",
      "workflow": "WaywoProjectWorkflow",
      "description": "Extract individual projects from a comment",
      "prompt": "You are an expert at analyzing Hacker News comments..."
    },
    {
      "step": "validate_project",
      "workflow": "WaywoProjectWorkflow",
      "description": "Validate whether text describes a real project",
      "prompt": "Determine if the following text describes a real project..."
    }
  ],
  "total": 8
}
```

| Field | Type | Description |
|---|---|---|
| `steps` | `array` | All workflow step definitions with their prompts |
| `total` | `int` | Number of workflow steps |

## List Available Workflows

List the workflows that are registered and available for visualization and traced execution.

```
GET /api/workflow-visualization/workflows
```

**Parameters:** None

**Response:** `200 OK`

```json
{
  "workflows": [
    {
      "name": "project",
      "description": "Extract, validate, and score projects from HN comments",
      "steps": ["extract_projects", "validate_project", "fetch_urls", "generate_metadata", "score_project", "embed_project"]
    },
    {
      "name": "chatbot",
      "description": "RAG chatbot workflow for answering questions about projects",
      "steps": ["embed_query", "retrieve_candidates", "rerank", "generate_response"]
    }
  ]
}
```

## Get Workflow Structure

Generate a static HTML visualization showing all possible paths through a workflow. Returns an HTML file that can be viewed in a browser.

```
GET /api/workflow-visualization/structure/{name}
```

**Path Parameters:**

| Parameter | Type | Description |
|---|---|---|
| `name` | `string` | Workflow name (`project` or `chatbot`) |

**Response:** `200 OK` -- HTML file download (`text/html`).

The returned HTML file contains an interactive diagram of the workflow DAG, showing steps, events, and transitions.

**Error:** `404` if the workflow name is not recognized. The error includes available workflow names:

```json
{
  "detail": "Workflow 'unknown' not found. Available: ['project', 'chatbot']"
}
```

## Run Workflow with Trace

Execute a workflow and capture its full execution trace, including timing and intermediate results for each step. The trace is saved as an HTML file for later inspection.

```
POST /api/workflow-visualization/run-with-trace/{name}
```

**Path Parameters:**

| Parameter | Type | Description |
|---|---|---|
| `name` | `string` | Workflow name (`project` or `chatbot`) |

**Query Parameters for `chatbot` workflow:**

| Parameter | Type | Default | Description |
|---|---|---|---|
| `query` | `string` | *required* | Chat query to process |
| `top_k` | `int` | `5` | Number of results for context |

**Query Parameters for `project` workflow:**

| Parameter | Type | Default | Description |
|---|---|---|---|
| `comment_id` | `int` | *required* | Comment ID to process |
| `comment_text` | `string` | *required* | Comment text content |

**Example -- Chatbot workflow:**

```
POST /api/workflow-visualization/run-with-trace/chatbot?query=What%20Rust%20projects%20exist&top_k=3
```

**Response:** `200 OK`

```json
{
  "execution_id": "a1b2c3d4",
  "workflow": "chatbot",
  "trace_file": "chatbot_a1b2c3d4_trace.html",
  "result": {
    "response": "Several people have shared Rust projects...",
    "source_projects": [
      {
        "id": 42,
        "title": "RustCLI Framework"
      }
    ],
    "projects_found": 3
  }
}
```

**Example -- Project workflow:**

```
POST /api/workflow-visualization/run-with-trace/project?comment_id=38805300&comment_text=Working%20on%20a%20CLI%20tool
```

**Response:** `200 OK`

```json
{
  "execution_id": "e5f6a7b8",
  "workflow": "project",
  "trace_file": "project_e5f6a7b8_trace.html",
  "result": { }
}
```

**Errors:**
- `400` if required parameters are missing for the specified workflow
- `404` if the workflow name is not recognized
- `500` if workflow execution fails

## List Execution Traces

List all saved execution trace HTML files from previous traced runs.

```
GET /api/workflow-visualization/executions
```

**Parameters:** None

**Response:** `200 OK`

```json
{
  "visualizations": [
    {
      "filename": "chatbot_a1b2c3d4_trace.html",
      "workflow": "chatbot",
      "created_at": "2024-01-15T10:30:00"
    },
    {
      "filename": "project_e5f6a7b8_trace.html",
      "workflow": "project",
      "created_at": "2024-01-15T09:15:00"
    }
  ]
}
```

Individual trace files can be downloaded at:

```
GET /api/workflow-visualization/executions/{filename}
```

This returns the saved HTML file (`text/html`) for viewing in a browser. Returns `404` if the file does not exist.

---
title: Search & Chat
description: Semantic search, agentic streaming chat, and legacy RAG chatbot API endpoints.
navigation.icon: i-lucide-search
---

# Search & Chat

Waywo provides AI-powered retrieval via **semantic search** for direct result lists and an **agentic RAG chat** for conversational project discovery with streaming. Both rely on vector embeddings and optional reranking via `llama-nemotron-rerank-1b`.

## Semantic Search

Embed a query and find the most similar projects using cosine similarity over the vector index. When reranking is enabled (the default), the API fetches 3x candidates and re-scores them with the rerank model for improved relevance.

```
POST /api/semantic-search
```

**Request Body:**

```json
{
  "query": "command line tools written in Rust",
  "limit": 5,
  "use_rerank": true
}
```

| Field | Type | Default | Description |
|---|---|---|---|
| `query` | `string` | *required* | Search query text (min 1 character) |
| `limit` | `int` | `10` | Maximum results to return (1-50) |
| `use_rerank` | `bool` | `true` | Whether to rerank results for better relevance |

**Response:** `200 OK`

```json
{
  "results": [
    {
      "project": {
        "id": 42,
        "title": "RustCLI Framework",
        "short_description": "Ergonomic CLI framework for Rust",
        "description": "A framework for building command-line applications in Rust with auto-generated help and completions.",
        "hashtags": ["rust", "cli", "devtools"],
        "idea_score": 8,
        "complexity_score": 6,
        "is_valid_project": true,
        "is_bookmarked": false
      },
      "similarity": 0.8932,
      "rerank_score": 0.9541
    }
  ],
  "query": "command line tools written in Rust",
  "total": 5,
  "reranked": true
}
```

| Field | Type | Description |
|---|---|---|
| `results[].similarity` | `float` | Cosine similarity score (0-1) |
| `results[].rerank_score` | `float \| undefined` | Rerank relevance score (present only when reranking succeeded) |
| `reranked` | `bool` | Whether reranking was applied |

**Error:** `503` if the embedding service is unavailable.

## Agentic Streaming Chat

Send a message to a chat thread and receive an SSE stream of agent events. The agent autonomously decides whether to search the project database using tool calling, then streams the answer token-by-token.

```
POST /api/chat/threads/{thread_id}/message/stream
```

**Request Body:**

```json
{
  "message": "Are there any projects related to shipping or freight?",
  "top_k": 5
}
```

| Field | Type | Default | Description |
|---|---|---|---|
| `message` | `string` | *required* | User's message text |
| `top_k` | `int` | `5` | Number of projects to retrieve per search |

**Response:** `200 OK` (SSE stream, `text/event-stream`)

The stream emits events in this order:

### Event: `thinking`

The agent is reasoning about what to do.

```
event: thinking
data: {"thought": "The user is asking about shipping projects. I need to search.", "iteration": 1}
```

### Event: `tool_call`

The agent is about to call a tool.

```
event: tool_call
data: {"tool": "search_projects", "input": "{\"query\": \"shipping freight\", \"top_k\": 5}"}
```

### Event: `tool_result`

A tool call completed.

```
event: tool_result
data: {"tool": "search_projects", "projects_found": 5, "result_summary": "Found 5 relevant projects..."}
```

### Event: `answer_start`

The final answer is about to stream.

```
event: answer_start
data: {}
```

### Event: `answer_token`

Individual tokens of the final answer (for real-time rendering).

```
event: answer_token
data: {"token": "Here"}
```

### Event: `answer_done`

The complete answer with source projects.

```
event: answer_done
data: {
  "full_text": "Here are some projects related to shipping...",
  "source_projects": [
    {
      "id": 63,
      "title": "Tenderlane",
      "short_description": "Automating freight tender analysis with Excel frontend",
      "similarity": 0.78,
      "hashtags": ["freight", "tender", "excel", "elixir", "phoenix"],
      "idea_score": 6,
      "complexity_score": 5
    }
  ]
}
```

### Event: `done`

Stream complete with timing information.

```
event: done
data: {"llm_duration_ms": 9492, "thread_id": "131161bc-cc63-42b4-a841-f10d7f702da5"}
```

### Event: `error`

Something went wrong during processing.

```
event: error
data: {"error": "Embedding service unreachable"}
```

**Error:** `404` if the thread is not found. `400` if the message is empty.

## Legacy RAG Chatbot

The original single-shot RAG endpoint. Does not support multi-turn conversation, streaming, or agent-style tool use.

```
POST /api/waywo-chatbot
```

**Request Body:**

```json
{
  "query": "What are some interesting AI projects people are building?",
  "top_k": 5
}
```

| Field | Type | Default | Description |
|---|---|---|---|
| `query` | `string` | *required* | User's question or message (min 1 character) |
| `top_k` | `int` | `5` | Number of projects to use as context (1-20) |

**Response:** `200 OK`

```json
{
  "response": "There are several interesting AI projects in the index...",
  "source_projects": [
    {
      "id": 101,
      "title": "LocalRAG",
      "description": "A local RAG system for searching personal documents"
    }
  ],
  "query": "What are some interesting AI projects people are building?",
  "projects_found": 5
}
```

| Field | Type | Description |
|---|---|---|
| `response` | `string` | AI-generated conversational answer |
| `source_projects` | `array` | Projects used as context for the answer |
| `projects_found` | `int` | Number of projects retrieved for context |

**Error:** `500` if the chatbot workflow fails (LLM or embedding service issues).

## Search Statistics

Get statistics about embedding coverage across the project index.

```
GET /api/semantic-search/stats
```

**Parameters:** None

**Response:** `200 OK`

```json
{
  "total_projects": 1200,
  "projects_with_embeddings": 1150,
  "embedding_coverage": 95.8
}
```

| Field | Type | Description |
|---|---|---|
| `total_projects` | `int` | Total project records in the database |
| `projects_with_embeddings` | `int` | Projects that have vector embeddings |
| `embedding_coverage` | `float` | Percentage of projects with embeddings |

## Embedding Service Health

Check whether the embedding service (`llama-embed-nemotron-8b`) is reachable.

```
GET /api/embedding/health
```

**Response:** `200 OK`

```json
{
  "status": "healthy",
  "url": "http://192.168.5.96:8000"
}
```

**Response:** `503 Service Unavailable`

```json
{
  "status": "unhealthy",
  "message": "Embedding service is not reachable",
  "url": "http://192.168.5.96:8000"
}
```

## Rerank Service Health

Check whether the rerank service (`llama-nemotron-rerank-1b`) is reachable.

```
GET /api/rerank/health
```

**Response:** `200 OK`

```json
{
  "status": "healthy",
  "url": "http://192.168.5.173:8111"
}
```

**Response:** `503 Service Unavailable`

```json
{
  "status": "unhealthy",
  "message": "Rerank service is not reachable",
  "url": "http://192.168.5.173:8111"
}
```

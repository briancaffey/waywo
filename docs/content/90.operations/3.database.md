---
title: Database Management
description: SQLite database location, backup procedures, vector index management, and admin reset operations.
navigation.icon: i-lucide-database
---

# Database Management

Waywo uses SQLite as its primary database, with the sqlite-vector extension for semantic search. Redis serves as the Celery broker and result backend.

## SQLite Database

The database file lives at `/app/data/waywo.db` inside containers, mapped to `./data/waywo.db` on the host via volume mount.

| Property | Value |
|----------|-------|
| File path (container) | `/app/data/waywo.db` |
| File path (host) | `./data/waywo.db` |
| Engine | SQLite with WAL mode |
| Vector extension | sqlite-vector (FLOAT32, 4096 dimensions, cosine distance) |
| Tables | `waywo_posts`, `waywo_comments`, `waywo_projects` |

The `migrate` service runs schema migrations automatically on startup before any other service accesses the database.

## Backup

SQLite stores everything in a single file, making backups straightforward.

```bash
# Simple file copy (stop writes first for consistency, or rely on WAL mode)
cp ./data/waywo.db ./data/waywo.db.backup

# Timestamped backup
cp ./data/waywo.db "./data/waywo-$(date +%Y%m%d-%H%M%S).db"
```

::note
With WAL mode enabled, SQLite handles concurrent reads safely. For a fully consistent backup during active writes, you can use the SQLite `.backup` command or briefly stop the backend and worker services.
::

## Statistics

Get current database and Redis statistics via the admin API:

```bash
curl -s http://localhost:8008/api/admin/stats | jq .
```

This returns counts for posts, comments, and projects, plus Redis key count and memory usage.

For semantic search coverage specifically:

```bash
curl -s http://localhost:8008/api/semantic-search/stats | jq .
```

Returns `total_projects`, `projects_with_embeddings`, and `embedding_coverage` percentage.

## Vector Index

The sqlite-vector extension supports a quantization index for faster approximate nearest-neighbor search. Rebuild it after bulk-adding or updating embeddings:

```bash
curl -X POST http://localhost:8008/api/admin/rebuild-vector-index
```

This calls `vector_quantize()` on the `description_embedding` column. It is safe to run at any time and will rebuild in place.

## Reset Operations

::warning
The following operations are **destructive and irreversible**. They permanently delete data. There is no confirmation prompt -- the API call executes immediately.
::

### Reset SQLite

Deletes all posts, comments, and projects from the database:

```bash
curl -X DELETE http://localhost:8008/api/admin/reset-sqlite
```

**Endpoint:** `DELETE /api/admin/reset-sqlite`

### Reset Redis

Flushes all Redis keys, including Celery task history and results:

```bash
curl -X DELETE http://localhost:8008/api/admin/reset-redis
```

**Endpoint:** `DELETE /api/admin/reset-redis`

### Reset All

Resets both SQLite and Redis in a single call:

```bash
curl -X DELETE http://localhost:8008/api/admin/reset-all
```

**Endpoint:** `DELETE /api/admin/reset-all`

If one database fails to reset, the endpoint returns HTTP 207 (Multi-Status) with partial results.

## After a Reset

After resetting data, you will need to re-run the full pipeline:

1. Trigger post collection: `POST /api/process-waywo-posts`
2. Wait for posts and comments to be fetched (monitor in Flower)
3. Trigger comment processing: `POST /api/process-waywo-comments`
4. Wait for project extraction to complete
5. Rebuild vector index: `POST /api/admin/rebuild-vector-index`
